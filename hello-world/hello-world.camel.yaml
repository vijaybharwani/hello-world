- rest:
    id: accounts-api
    description: Accounts API
    path: /accounts
    post:
      - id: post-fa09
        path: /
        to: direct:new-account
- route:
    id: route-e42a
    description: Open New Account Route
    from:
      id: from-5726
      description: Direct
      uri: direct
      parameters:
        name: new-account
      steps:
        - setProperty:
            id: setProperty-5792
            description: Request
            name: requestPayload
            expression:
              datasonnet:
                id: datasonnet-ca44
                expression: payload
                bodyMediaType: application/json
                outputMediaType: application/java
                resultType: java.util.HashMap
        - to:
            id: to-1a11
            description: Generate Token
            uri: direct
            parameters:
              name: generate-token
        - to:
            id: to-b432
            description: Get Person By Name
            uri: direct
            parameters:
              name: get-person-by-name
        - choice:
            id: choice-0d57
            when:
              - id: when-1303
                description: Person Found
                expression:
                  datasonnet:
                    id: datasonnet-6f1a
                    expression: (std.length(payload)) > 0
                steps:
                  - log:
                      id: log-564f
                      message: 'Person Found '
                  - to:
                      id: to-6738
                      description: Create Account
                      uri: direct
                      parameters:
                        name: create-account
            otherwise:
              id: otherwise-a0fe
              description: Not Found
              steps:
                - log:
                    id: log-41ed
                    message: Person Not Found
                - to:
                    id: to-e7b9
                    description: KYC Check
                    uri: direct
                    parameters:
                      name: kyc-check
                - choice:
                    id: choice-8c47
                    when:
                      - id: when-3ff2
                        description: KYC Validation Pass
                        expression:
                          ognl:
                            id: ognl-c43b
                            expression: request.body.valid == true
                        steps:
                          - log:
                              id: log-f29e
                              message: Valid KYC
                          - to:
                              id: to-5c9c
                              description: Create Person
                              uri: direct
                              parameters:
                                name: create-person
                          - to:
                              id: to-b6e3
                              description: Create Account
                              uri: direct
                              parameters:
                                name: create-account
                    otherwise:
                      id: otherwise-3590
                      steps:
                        - throwException:
                            id: throwException-83d2
                            description: Throw Exception - KYC Validation Failed
                            message: KYC Validation Failed
                            exceptionType: java.lang.RuntimeException
- route:
    id: route-7aac
    nodePrefixId: route-b50
    from:
      id: from-230c
      uri: kamelet:timer-source
      parameters:
        message: Hello
        period: 5000
      steps:
        - log:
            id: log-55c1
            message: ${body}
- routeConfiguration: {}
